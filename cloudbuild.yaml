steps:
  # 1. Create virtual environment (Python 3.12) on Google Cloud Build App Engine
  - name: 'python:3.12'
    entrypoint: '/bin/bash' # Use bash to execute multiple commands on Google Cloud Build
    args:
      - '-c'
      - |
        python3 -m venv venv  # Create virtual environment named 'venv'
        source venv/bin/activate  # Activate the virtual environment

  # 2. Install Python dependencies within the virtual environment
  - name: 'python:3.12'
    entrypoint: 'pip'
    args: ['install', '-r', 'backend/requirements.txt']
    dir: 'backend'  # Specify working directory (assuming backend folder)

  # 3. Build the React app (unchanged)
  - name: 'node:20'
    entrypoint: 'npm'
    args: ['install']
    dir: 'src'

  - name: 'node:20'
    entrypoint: 'npm'
    args: ['run', 'build']
    dir: 'src'

  # 4. Deploy the App Engine application
  - name: 'gcr.io/cloud-builders/gcloud'
    args: ['app', 'deploy', 'app.yaml']

options:
  logging: 'CLOUD_LOGGING_ONLY'
